# SCRMDetection

Tool used to analyze features of coarse-grained refactorings

## Coarse-grained Refactoring
Refactorings can be detected only in coarse-grained commits rather in fine-grained ones. Coarse-grained commits can be generated by squashing multiple consecutive fine-grained commits.

## Refactoring Detection
Refactoring detection tool used is [RefactoringMiner2.2](https://github.com/tsantalis/RefactoringMiner)

Both refactorings in coarse and fine-gained commits will be detected and compared.

## Coarse-grained Commits Generation
Repository rewrite tool [git-stein](https://github.com/sh5i/git-stein) is used to squash commits to generate coarse-grained commits

## What can it do

### Calculate Frequency
- Coarse-grained refactoirngs occurence frequency
### Analyse Type
- Which types of refactorings tend to be coarse-grained refactorings
### Analyse Reason
- Reasons for the occurence of coarse-grained refactorings can be observed by using results from this tool with code change in fine-grained commits

## Procedure
Procedure is showed below
![alt text](https://github.com/MashiroCl/SCRMDetection/blob/main/study_procedure.png)


# Update: 2024/10/18

## Getting Started

### Prerequisite
```shell
python@3.9
```

### How to use it
* Remove Comments
```shell
python3 remove_comment.py -s <input_repo_path> -t <output_repo_path>
```

* Mine refactorings for different granularities
```shell
nohup python3 command.py -r /Users/leichen/Code/pythonProject/pythonProject/pythonProject/SCRMDetection/experiment/data/refactoring-toy-example_cr -c 5 -o /Users/leichen/Code/pythonProject/pythonProject/pythonProject/SCRMDetection/experiment/output/result/ -p local >run_log/refactoring-toy-example_cr5.log 2>&1 &
```

* trace
```shell
python3 command.py -m trace -r /Users/leichen/Code/pythonProject/pythonProject/pythonProject/SCRMDetection/experiment/data/refactoring-toy-example_cr -d /Users/leichen/Code/pythonProject/pythonProject/pythonProject/SCRMDetection/experiment/output/result/refactoring-toy-example_cr/ --start 2 --end 5 >run_log/so_tr_refactoring-toy-example_cr.log
```

* retrace
```shell
python3 retrace.py -t /Users/leichen/Code/pythonProject/pythonProject/pythonProject/SCRMDetection/experiment/output/result/refactoring-toy-example_cr/ -r /Users/leichen/Code/pythonProject/pythonProject/pythonProject/SCRMDetection/experiment/data/refactoring-toy-example_cr >run_log/retrace_refactoring-toy-example_cr.log
```


trace is for compare refs in fined-grained and coarse-grained
retrace is for compare refs in different granularities coarse-grained commits


### RQs
* RQ1: How frequently do CGRs appear because of granularity change?
in `/RQs/RQ1_seperate.py`, 